<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README.pt-pt
  
    &mdash; Sinatra API Documentation
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.pt-pt.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README.pt-pt</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'><h1>Sinatra</h1>

<p><em>Atenção: Este documento é apenas uma tradução da versão em inglês e
pode estar desatualizado.</em></p>

<p>Sinatra é uma
<a href="http://pt.wikipedia.org/wiki/Linguagem_de_dom%C3%ADnio_espec%C3%ADfico">DSL</a> para
criar rapidamente aplicações web em Ruby com o mínimo de esforço:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># minhaapp.rb
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rubygems</span><span class='tstring_end'>'</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>'</span></span>
<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Olá Mundo!</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Instale a gem e execute com:</p>

<pre class="code shell"><code class="shell">sudo gem install sinatra
ruby minhaapp.rb
</code></pre>

<p>Aceda em: <a href="http://localhost:4567">localhost:4567</a></p>

<h2>Rotas</h2>

<p>No Sinatra, uma rota é um metodo HTTP associado a uma URL correspondente
padrão. Cada rota é associada a um bloco:</p>

<pre class="code ruby"><code class="ruby">get '/' do
  .. mostrar algo ..
end

post '/' do
  .. criar algo ..
end

put '/' do
  .. atualizar algo ..
end

delete '/' do
  .. apagar algo ..
end
</code></pre>

<p>Rotas são encontradas na ordem em que são definidas. A primeira rota que
é encontrada invoca o pedido.</p>

<p>Padrões de rota podem incluir parâmetros nomeados, acessíveis através da
hash <code>params</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/ola/:nome</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='comment'># corresponde a &quot;GET /ola/foo&quot; e &quot;GET /ola/bar&quot;
</span>  <span class='comment'># params['nome'] é 'foo' ou 'bar'
</span>  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Olá </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>nome</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Pode também aceder a parâmetros nomeados através do bloco de parâmetros:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/ola/:nome</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_n'>n</span><span class='op'>|</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Olá </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_n'>n</span><span class='rbrace'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Padrões de rota podem também incluir parâmetros splat (asteriscos),
acessíveis através do array <code>params[&#39;splat&#39;]</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/diga/*/ao/*</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='comment'># corresponde a /diga/ola/ao/mundo
</span>  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>splat</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='comment'># =&gt; [&quot;ola&quot;, &quot;mundo&quot;]
</span><span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/download/*.*</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='comment'># corresponde a /download/pasta/do/arquivo.xml
</span>  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>splat</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='comment'># =&gt; [&quot;pasta/do/arquivo&quot;, &quot;xml&quot;]
</span><span class='kw'>end</span>
</code></pre>

<p>Rotas correspondem-se com expressões regulares:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\/ola\/([\w]+)\z</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Olá, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>captures</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rbrace'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Ou com um bloco de parâmetro:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>/ola/([\w]+)</span><span class='regexp_end'>}</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Olá, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_c'>c</span><span class='rbrace'>}</span><span class='tstring_content'>!</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Rotas podem incluir uma variedade de condições correspondentes, por
exemplo, o agente usuário:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/foo</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:agent</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>Songbird (\d\.\d)[\d\/]*?</span><span class='regexp_end'>/</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Você está a utilizar a versão </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>agent</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> do Songbird.</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/foo</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='comment'># Corresponde a um navegador não Songbird
</span><span class='kw'>end</span>
</code></pre>

<h2>Arquivos estáticos</h2>

<p>Arquivos estáticos são disponibilizados a partir do directório
<code>./public</code>. Você pode especificar um local diferente através da opção
<code>:public_folder</code></p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'>set</span> <span class='symbol'>:public_folder</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/estatico</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>Note que o nome do directório público não é incluido no URL. Um arquivo
<code>./public/css/style.css</code> é disponibilizado como
<code>http://example.com/css/style.css</code>.</p>

<h2>Views / Templates</h2>

<p>Templates presumem-se estar localizados sob o directório <code>./views</code>. Para
utilizar um directório de views diferente:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'>set</span> <span class='symbol'>:views</span><span class='comma'>,</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/modelo</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>Uma coisa importante a ser lembrada é que você sempre tem as referências
dos templates como símbolos, mesmo se eles estiverem num sub-directório
(nesse caso utilize <code>:&#39;subdir/template&#39;</code>). Métodos de renderização irão
processar qualquer string passada directamente para elas.</p>

<h3>Haml Templates</h3>

<p>A gem/biblioteca haml é necessária para renderizar templates HAML:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># É necessário requerir 'haml' na aplicação.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>haml</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:index</span>
<span class='kw'>end</span>
</code></pre>

<p>Renderiza <code>./views/index.haml</code>.</p>

<p><a href="http://haml.info/docs/yardoc/file.HAML_REFERENCE.html#options">Opções
Haml</a>
podem ser definidas globalmente através das configurações do sinatra,
veja <a href="http://www.sinatrarb.com/configuration.html">Opções e
Configurações</a>, e substitua
em uma requisição individual.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'>set</span> <span class='symbol'>:haml</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:html5</span> <span class='rbrace'>}</span> <span class='comment'># o formato padrão do Haml é :xhtml
</span>
<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:index</span><span class='comma'>,</span> <span class='symbol'>:haml_options</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:html4</span> <span class='rbrace'>}</span> <span class='comment'># substituido
</span><span class='kw'>end</span>
</code></pre>

<h3>Erb Templates</h3>

<pre class="code ruby"><code class="ruby"><span class='comment'># É necessário requerir 'erb' na aplicação.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>erb</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erb'>erb</span> <span class='symbol'>:index</span>
<span class='kw'>end</span>
</code></pre>

<p>Renderiza <code>./views/index.erb</code></p>

<h3>Erubis</h3>

<p>A gem/biblioteca erubis é necessária para renderizar templates erubis:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># É necessário requerir 'erubis' na aplicação.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>erubis</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_erubis'>erubis</span> <span class='symbol'>:index</span>
<span class='kw'>end</span>
</code></pre>

<p>Renderiza <code>./views/index.erubis</code></p>

<h3>Builder Templates</h3>

<p>A gem/biblioteca builder é necessária para renderizar templates builder:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># É necessário requerir 'builder' na aplicação.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>builder</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>application/xml</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:charset</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_builder'>builder</span> <span class='symbol'>:index</span>
<span class='kw'>end</span>
</code></pre>

<p>Renderiza <code>./views/index.builder</code>.</p>

<h3>Sass Templates</h3>

<p>A gem/biblioteca sass é necessária para renderizar templates sass:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># É necessário requerir 'haml' ou 'sass' na aplicação.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sass</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/stylesheet.css</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text/css</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:charset</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_sass'>sass</span> <span class='symbol'>:stylesheet</span>
<span class='kw'>end</span>
</code></pre>

<p>Renderiza <code>./views/stylesheet.sass</code>.</p>

<p><a href="http://sass-lang.com/docs/yardoc/file.SASS_REFERENCE.html#options">Opções
Sass</a>
podem ser definidas globalmente através das configurações do sinatra,
veja <a href="http://www.sinatrarb.com/configuration.html">Opções e
Configurações</a>, e substitua
em uma requisição individual.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_set'>set</span> <span class='symbol'>:sass</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:style</span> <span class='op'>=&gt;</span> <span class='symbol'>:compact</span> <span class='rbrace'>}</span> <span class='comment'># o estilo padrão do Sass é :nested
</span>
<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/stylesheet.css</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text/css</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:charset</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_sass'>sass</span> <span class='symbol'>:stylesheet</span><span class='comma'>,</span> <span class='symbol'>:style</span> <span class='op'>=&gt;</span> <span class='symbol'>:expanded</span> <span class='comment'># substituido
</span><span class='kw'>end</span>
</code></pre>

<h3>Less Templates</h3>

<p>A gem/biblioteca less é necessária para renderizar templates Less:</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># É necessário requerir 'less' na aplicação.
</span><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>less</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/stylesheet.css</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_content_type'>content_type</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text/css</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:charset</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>utf-8</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_less'>less</span> <span class='symbol'>:stylesheet</span>
<span class='kw'>end</span>
</code></pre>

<p>Renderiza <code>./views/stylesheet.less</code>.</p>

<h3>Templates Inline</h3>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%div.title Olá Mundo</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Renderiza a string, em uma linha, no template.</p>

<h3>Acedendo a Variáveis nos Templates</h3>

<p>Templates são avaliados dentro do mesmo contexto que os manipuladores de
rota. Variáveis de instância definidas em rotas manipuladas são
directamente acedidas por templates:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/:id</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='ivar'>@foo</span> <span class='op'>=</span> <span class='const'>Foo</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>id</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%h1= @foo.nome</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>Ou, especifique um hash explícito para variáveis locais:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/:id</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_foo'>foo</span> <span class='op'>=</span> <span class='const'>Foo</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>id</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%h1= foo.nome</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:locals</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span> <span class='symbol'>:foo</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_foo'>foo</span> <span class='rbrace'>}</span>
<span class='kw'>end</span>
</code></pre>

<p>Isso é tipicamente utilizado quando renderizamos templates parciais
(partials) dentro de outros templates.</p>

<h3>Templates Inline</h3>

<p>Templates podem ser definidos no final do arquivo fonte(.rb):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rubygems</span><span class='tstring_end'>'</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:index</span>
<span class='kw'>end</span>

<span class='__end__'>__END__
</span></code></pre>

<p>NOTA: Templates inline definidos no arquivo fonte são automaticamente
carregados pelo sinatra. Digite `enable :inline_templates` se tem
templates inline no outro arquivo fonte.</p>

<h3>Templates nomeados</h3>

<p>Templates também podem ser definidos utilizando o método top-level
<code>template</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_template'>template</span> <span class='symbol'>:layout</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%html\n  =yield\n</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_template'>template</span> <span class='symbol'>:index</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>%div.title Olá Mundo!</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:index</span>
<span class='kw'>end</span>
</code></pre>

<p>Se existir um template com nome “layout”, ele será utilizado sempre que
um template for renderizado. Pode desactivar layouts usando
<code>:layout =&gt; false</code>.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_haml'>haml</span> <span class='symbol'>:index</span><span class='comma'>,</span> <span class='symbol'>:layout</span> <span class='op'>=&gt;</span> <span class='op'>!</span><span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_xhr?'>xhr?</span>
<span class='kw'>end</span>
</code></pre>

<h2>Helpers</h2>

<p>Use o método de alto nível <code>helpers</code> para definir métodos auxiliares
para utilizar em manipuladores de rotas e modelos:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_helpers'>helpers</span> <span class='kw'>do</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_bar'>bar</span><span class='lparen'>(</span><span class='id identifier rubyid_nome'>nome</span><span class='rparen'>)</span>
    <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_nome'>nome</span><span class='rbrace'>}</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/:nome</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_bar'>bar</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>nome</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='kw'>end</span>
</code></pre>

<h2>Filtros</h2>

<p>Filtros Before são avaliados antes de cada requisição dentro do contexto
da requisição e podem modificar a requisição e a reposta. Variáveis de
instância definidas nos filtros são acedidas através de rotas e
templates:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'>before</span> <span class='kw'>do</span>
  <span class='ivar'>@nota</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Olá!</span><span class='tstring_end'>'</span></span>
  <span class='id identifier rubyid_request'>request</span><span class='period'>.</span><span class='id identifier rubyid_path_info'>path_info</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/foo/bar/baz</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/foo/*</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='ivar'>@nota</span> <span class='comment'>#=&gt; 'Olá!'
</span>  <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>splat</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='comment'>#=&gt; 'bar/baz'
</span><span class='kw'>end</span>
</code></pre>

<p>Filtros After são avaliados após cada requisição dentro do contexto da
requisição e também podem modificar o pedido e a resposta. Variáveis de
instância definidas nos filtros before e rotas são acedidas através dos
filtros after:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_after'>after</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_response'>response</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>
<span class='kw'>end</span>
</code></pre>

<p>Filtros opcionalmente têm um padrão, fazendo com que sejam avaliados
somente se o caminho do pedido coincidir com esse padrão:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_before'>before</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/protected/*</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_autenticar!'>autenticar!</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_after'>after</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/create/:slug</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_slug'>slug</span><span class='op'>|</span>
  <span class='id identifier rubyid_session'>session</span><span class='lbracket'>[</span><span class='symbol'>:last_slug</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_slug'>slug</span>
<span class='kw'>end</span>
</code></pre>

<h2>Halting</h2>

<p>Para parar imediatamente uma requisição dentro de um filtro ou rota
utilize:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span>
</code></pre>

<p>Pode também especificar o status ao parar…</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='int'>410</span>
</code></pre>

<p>Ou com um corpo de texto…</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>isto será o corpo de texto</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>Ou também…</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='int'>401</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>vamos embora!</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>Com cabeçalhos…</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_halt'>halt</span> <span class='int'>402</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Content-Type</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text/plain</span><span class='tstring_end'>'</span></span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>revanche</span><span class='tstring_end'>'</span></span>
</code></pre>

<h2>Passing</h2>

<p>Dentro de uma rota, pode passar para a próxima rota correspondente
usando <code>pass</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/adivinhar/:quem</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_pass'>pass</span> <span class='kw'>unless</span> <span class='id identifier rubyid_params'>params</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>quem</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Frank</span><span class='tstring_end'>'</span></span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Apanhaste-me!</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/adivinhar/*</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Falhaste!</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>O bloqueio da rota é imediatamente encerrado e o controle continua com a
próxima rota de parâmetro. Se o parâmetro da rota não for encontrado, um
404 é retornado.</p>

<h2>Configuração</h2>

<p>Correndo uma vez, na inicialização, em qualquer ambiente:</p>

<pre class="code ruby"><code class="ruby">configure do
  ...
end
</code></pre>

<p>Correndo somente quando o ambiente (<code>RACK_ENV</code> environment variável) é
definido para <code>:production</code>:</p>

<pre class="code ruby"><code class="ruby">configure :production do
  ...
end
</code></pre>

<p>Correndo quando o ambiente é definido para <code>:production</code> ou <code>:test</code>:</p>

<pre class="code ruby"><code class="ruby">configure :production, :test do
  ...
end
</code></pre>

<h2>Lidar com Erros</h2>

<p>Lida-se com erros no mesmo contexto das rotas e filtros before, o que
signifca que <code>haml</code>, <code>erb</code>, etc, estão disponíveis.</p>

<h3>Não Encontrado</h3>

<p>Quando um <code>Sinatra::NotFound</code> exception é levantado, ou o código de
status da reposta é 404, o manipulador <code>not_found</code> é invocado:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_not_found'>not_found</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Isto está longe de ser encontrado</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<h3>Erro</h3>

<p>O manipulador <code>error</code> é invocado sempre que uma exceção é lançada a
partir de um bloco de rota ou um filtro. O objecto da exceção pode ser
obtido a partir da variável Rack <code>sinatra.error</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'>error</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Peço desculpa, houve um erro desagradável - </span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sinatra.error</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>
</code></pre>

<p>Erros personalizados:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'>error</span> <span class='const'>MeuErroPersonalizado</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>O que aconteceu foi...</span><span class='tstring_end'>'</span></span> <span class='op'>+</span> <span class='id identifier rubyid_env'>env</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sinatra.error</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_message'>message</span>
<span class='kw'>end</span>
</code></pre>

<p>Então, se isso acontecer:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>MeuErroPersonalizado</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>alguma coisa desagradável</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>O resultado será:</p>

<pre class="code ruby"><code class="ruby">O que aconteceu foi...alguma coisa desagradável
</code></pre>

<p>Alternativamente, pode definir um manipulador de erro para um código de
status:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'>error</span> <span class='int'>403</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Accesso negado</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/secreto</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='int'>403</span>
<span class='kw'>end</span>
</code></pre>

<p>Ou um range (alcance):</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_error'>error</span> <span class='int'>400</span><span class='op'>..</span><span class='int'>510</span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Boom</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>O Sinatra define os manipuladores especiais <code>not_found</code> e <code>error</code> quando
corre no ambiente de desenvolvimento.</p>

<h2>Mime Types</h2>

<p>Quando utilizamos <code>send_file</code> ou arquivos estáticos pode ter mime types
Sinatra não entendidos. Use <code>mime_type</code> para os registar por extensão de
arquivos:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_mime_type'>mime_type</span> <span class='symbol'>:foo</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>text/foo</span><span class='tstring_end'>'</span></span>
</code></pre>

<p>Pode também utilizar isto com o helper <code>content_type</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_content_type'>content_type</span> <span class='symbol'>:foo</span>
</code></pre>

<h2>Middleware Rack</h2>

<p>O Sinatra corre no <a href="http://rack.github.io/">Rack</a>, uma interface
padrão mínima para frameworks web em Ruby. Uma das capacidades mais
interessantes do Rack, para desenvolver aplicações, é o suporte de
“middleware” – componentes que residem entre o servidor e a aplicação,
monitorizando e/ou manipulando o pedido/resposta (request/response) HTTP
para providenciar varios tipos de funcionalidades comuns.</p>

<p>O Sinatra torna a construção de pipelines do middleware Rack fácil a um
nível superior utilizando o método <code>use</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>'</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>meu_middleware_personalizado</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_use'>use</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Lint</span>
<span class='id identifier rubyid_use'>use</span> <span class='const'>MeuMiddlewarePersonalizado</span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/ola</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Olá mundo</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>A semântica de <code>use</code> é idêntica aquela definida para a DSL
<a href="http://rubydoc.info/github/rack/rack/master/Rack/Builder">Rack::Builder</a>
(mais frequentemente utilizada para arquivos rackup). Por exemplo, o
método <code>use</code> aceita múltiplos argumentos/variáveis, bem como blocos:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_use'>use</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Auth</span><span class='op'>::</span><span class='const'>Basic</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_utilizador'>utilizador</span><span class='comma'>,</span> <span class='id identifier rubyid_senha'>senha</span><span class='op'>|</span>
  <span class='id identifier rubyid_utilizador'>utilizador</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>admin</span><span class='tstring_end'>'</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_senha'>senha</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>secreto</span><span class='tstring_end'>'</span></span>
<span class='kw'>end</span>
</code></pre>

<p>O Rack é distribuido com uma variedade de middleware padrões para logs,
debugs, rotas de URL, autenticação, e manipuladores de sessão.Sinatra
utiliza muitos desses componentes automaticamente dependendo da
configuração, por isso, tipicamente nao é necessário utilizar <code>use</code>
explicitamente.</p>

<h2>Testando</h2>

<p>Testes no Sinatra podem ser escritos utilizando qualquer biblioteca ou
framework de teste baseados no Rack.
<a href="http://gitrdoc.com/brynary/rack-test">Rack::Test</a> é recomendado:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>minha_aplicacao_sinatra</span><span class='tstring_end'>'</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rack/test</span><span class='tstring_end'>'</span></span>

<span class='kw'>class</span> <span class='const'>MinhaAplicacaoTeste</span> <span class='op'>&lt;</span> <span class='const'>Minitest</span><span class='op'>::</span><span class='const'>Test</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'>Rack</span><span class='op'>::</span><span class='const'>Test</span><span class='op'>::</span><span class='const'>Methods</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_app'>app</span>
    <span class='const'>Sinatra</span><span class='op'>::</span><span class='const'>Application</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_meu_test_default'>meu_test_default</span>
    <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Ola Mundo!</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_teste_com_parametros'>teste_com_parametros</span>
    <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/atender</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:name</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Frank</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Olá Frank!</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span><span class='period'>.</span><span class='id identifier rubyid_bodymeet'>bodymeet</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_test_com_ambiente_rack'>test_com_ambiente_rack</span>
    <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>HTTP_USER_AGENT</span><span class='tstring_end'>'</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Songbird</span><span class='tstring_end'>'</span></span>
    <span class='id identifier rubyid_assert_equal'>assert_equal</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Você está utilizando o Songbird!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_last_response'>last_response</span><span class='period'>.</span><span class='id identifier rubyid_body'>body</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>NOTA: Os módulos de classe embutidos <code>Sinatra::Test</code> e
<code>Sinatra::TestHarness</code> são depreciados na versão 0.9.2.</p>

<h2>Sinatra::Base - Middleware, Bibliotecas e aplicativos modulares</h2>

<p>Definir sua aplicação a um nível superior de trabalho funciona bem para
micro aplicativos, mas tem consideráveis incovenientes na construção de
componentes reutilizáveis como um middleware Rack, metal Rails,
bibliotecas simples como um componente de servidor, ou mesmo extensões
Sinatra. A DSL de nível superior polui o espaço do objeto e assume um
estilo de configuração de micro aplicativos (exemplo: um simples arquivo
de aplicação, directórios <code>./public</code> e <code>./views</code>, logs, página de detalhes
de excepção, etc.). É onde o Sinatra::Base entra em jogo:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sinatra/base</span><span class='tstring_end'>'</span></span>

<span class='kw'>class</span> <span class='const'>MinhaApp</span> <span class='op'>&lt;</span> <span class='const'>Sinatra</span><span class='op'>::</span><span class='const'>Base</span>
  <span class='id identifier rubyid_set'>set</span> <span class='symbol'>:sessions</span><span class='comma'>,</span> <span class='kw'>true</span>
  <span class='id identifier rubyid_set'>set</span> <span class='symbol'>:foo</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>bar</span><span class='tstring_end'>'</span></span>

  <span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
    <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>Olá mundo!</span><span class='tstring_end'>'</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>A classe MinhaApp é um componente Rack independente que pode utilizar
como um middleware Rack, uma aplicação Rack, ou metal Rails. Pode
utilizar ou executar esta classe com um arquivo rackup <code>config.ru</code>;
ou, controlar um componente de servidor fornecendo como biblioteca:</p>

<pre class="code ruby"><code class="ruby"><span class='const'>MinhaApp</span><span class='period'>.</span><span class='id identifier rubyid_run!'>run!</span> <span class='symbol'>:host</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>localhost</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:port</span> <span class='op'>=&gt;</span> <span class='int'>9090</span>
</code></pre>

<p>Os métodos disponíveis para subclasses <code>Sinatra::Base</code> são exatamente como
aqueles disponíveis via a DSL de nível superior. Aplicações de nível
mais alto podem ser convertidas para componentes <code>Sinatra::Base</code> com duas
modificações:</p>

<ul>
<li><p>Seu arquivo deve requerer <code>sinatra/base</code> ao invés de <code>sinatra</code>;
outra coisa, todos os métodos DSL do Sinatra são importados para o
espaço principal.</p></li>
<li><p>Coloque as rotas da sua aplicação, manipuladores de erro, filtros e
opções na subclasse de um <code>Sinatra::Base</code>.</p></li>
</ul>

<p><code>Sinatra::Base</code> é um quadro branco. Muitas opções são desactivadas por
padrão, incluindo o servidor embutido. Veja <a href="http://sinatra.github.com/configuration.html">Opções e
Configurações</a> para
detalhes de opções disponíveis e seus comportamentos.</p>

<p>SIDEBAR: A DSL de alto nível do Sinatra é implementada utilizando um simples
sistema de delegação. A classe <code>Sinatra::Application</code> – uma subclasse especial
da <code>Sinatra::Base</code> – recebe todos os <code>:get</code>, <code>:put</code>, <code>:post</code>, <code>:delete</code>,
<code>:before</code>, <code>:error</code>, <code>:not_found</code>, <code>:configure</code>, e <code>:set</code> messages enviados
para o alto nível. Dê você mesmo uma vista de olhos ao código: aqui está o
<a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/base.rb#L1128">Sinatra::Delegator
mixin</a>
sendo <a href="http://github.com/sinatra/sinatra/blob/ceac46f0bc129a6e994a06100aa854f606fe5992/lib/sinatra/main.rb#L28">incluido dentro de um espaço
principal</a></p>

<h2>Linha de Comandos</h2>

<p>As aplicações Sinatra podem ser executadas directamente:</p>

<pre class="code shell"><code class="shell">ruby minhaapp.rb [-h] [-x] [-e AMBIENTE] [-p PORTA] [-o HOST] [-s SERVIDOR]
</code></pre>

<p>As opções são:</p>

<pre class="code ruby"><code class="ruby"><span class='op'>-</span><span class='id identifier rubyid_h'>h</span> <span class='comment'># ajuda
</span><span class='op'>-</span><span class='id identifier rubyid_p'>p</span> <span class='comment'># define a porta (padrão é 4567)
</span><span class='op'>-</span><span class='id identifier rubyid_o'>o</span> <span class='comment'># define o host (padrão é 0.0.0.0)
</span><span class='op'>-</span><span class='id identifier rubyid_e'>e</span> <span class='comment'># define o ambiente (padrão é development)
</span><span class='op'>-</span><span class='id identifier rubyid_s'>s</span> <span class='comment'># especifica o servidor/manipulador rack (padrão é thin)
</span><span class='op'>-</span><span class='id identifier rubyid_x'>x</span> <span class='comment'># activa o bloqueio (padrão é desligado)
</span></code></pre>

<h2>A última versão</h2>

<p>Se gostaria de utilizar o código da última versão do Sinatra, crie um
clone local e execute sua aplicação com o directório <code>sinatra/lib</code> no
<code>LOAD_PATH</code>:</p>

<pre class="code shell"><code class="shell">cd minhaapp
git clone git://github.com/sinatra/sinatra.git
ruby -I sinatra/lib minhaapp.rb
</code></pre>

<p>Alternativamente, pode adicionar o directório do <code>sinatra/lib</code> no
<code>LOAD_PATH</code> do seu aplicativo:</p>

<pre class="code ruby"><code class="ruby"><span class='gvar'>$LOAD_PATH</span><span class='period'>.</span><span class='id identifier rubyid_unshift'>unshift</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_dirname'>dirname</span><span class='lparen'>(</span><span class='kw'>__FILE__</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/sinatra/lib</span><span class='tstring_end'>'</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rubygems</span><span class='tstring_end'>'</span></span>
<span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>sinatra</span><span class='tstring_end'>'</span></span>

<span class='id identifier rubyid_get'>get</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>/sobre</span><span class='tstring_end'>'</span></span> <span class='kw'>do</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Estou correndo a versão</span><span class='tstring_end'>&quot;</span></span> <span class='op'>+</span> <span class='const'>Sinatra</span><span class='op'>::</span><span class='const'>VERSION</span>
<span class='kw'>end</span>
</code></pre>

<p>Para actualizar o código do Sinatra no futuro:</p>

<pre class="code shell"><code class="shell">cd meuprojeto/sinatra
git pull
</code></pre>

<h2>Mais</h2>

<ul>
<li><p><a href="http://www.sinatrarb.com/">Website do Projeto</a> - Documentação
adicional, novidades e links para outros recursos.</p></li>
<li><p><a href="http://www.sinatrarb.com/contributing">Contribuir</a> - Encontrou um
bug? Precisa de ajuda? Tem um patch?</p></li>
<li><p><a href="http://github.com/sinatra/sinatra/issues">Acompanhar Questões</a></p></li>
<li><p><a href="http://twitter.com/sinatra">Twitter</a></p></li>
<li><p><a href="http://groups.google.com/group/sinatrarb/topics">Lista de Email</a></p></li>
<li><p><a href="irc://chat.freenode.net/#sinatra">IRC: #sinatra</a> em
<a href="http://freenode.net">freenode.net</a></p></li>
</ul>
</div></div>

    <div id="footer">
  Generated on Thu Sep 24 16:24:28 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-1.9.3).
</div>

  </body>
</html>